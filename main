#!/bin/env bash
# -*- coding: utf-8 -*-
#
## @Author: sensor-dream
## @Email: sensor-dream@sensor-dream.ru
## @Copyright © sensor-dream. All rights reserved. Contacts: sensor-dream@sensor-dream.ru
## @Copyright © sensor-dream. All rights reserved. Contacts: sensor-dream@sensor-dream.ru
## @Copyright © Sensor-Dream Boxed System (SDBS). Contacts: sensor-dream@sensor-dream.ru
## @License: http://www.apache.org/licenses/LICENSE-2.0
## @Site: https://sensor-dream.ru
## @File: main
## @Creation date file: 12.09.2020, 09:32:01

declare -rx main_script_source="$BASH_SOURCE"

if [[ -z "${main_run_script_path}" ]]; then
  declare -rx main_run_script_path="$(pwd)"
  printf "Script runs from path: %s\n" "${main_run_script_path}"
fi

if [[ -z "${main_cfg_script_source}" ]]; then
  check=1
  while [[ "${check}" -eq 1 ]]; do
    if [[ ! -f 'main.cfg' ]]; then
      if [[ "$(pwd)" != "/" ]]; then
        cd ../
      else
        cd ${main_run_script_path}
        check=0
        echo -e '\e[31m'"!!! Not found configuration shared file !!!\033[0m"
        tput sgr0
        exit 1
      fi
    else
      check=0
      declare -rx main_project_path="$(pwd)"
      . "${main_project_path}/main.cfg" "$@"
      cd "${main_run_script_path}"
    fi
  done
fi

printf "Loading: %s\n" "$(readlink -m ${BASH_SOURCE})"

function main_main_script_source() {

  local main_txt_file="${main_project_path}/main.txt"

  prinf "Initialise main function of main script source\n"

  echo 'FIP (Fedora Instalation and Preparation)'

  echo -e "\nManually installed packages are also added when the system is cleanly installed.\nIt also specifies which scripts were run and in what order.\nThis file will be used for accelerated installation and configuration of the system from scratch, to get started.\n"

  printf '%s\n\t%s\n\t%s\n%s\n\t%s\n%s\n\t%s\n\n' 'Find one packages list:' \
    "cat ${main_txt_file} | sort -udi | tee ${main_txt_file}" \
    "cat ${main_txt_file} | awk -F': ' '/Имя(\s+)?:(\s+)?/ { print $2 }' | sort -udi" \
    'Install one packages list:' \
    "sudo dnf install \$(cat ${main_txt_file} | awk -F': ' '/Имя(\s+)?:(\s+)?/ { print $2 }' | sort -udi)" \
    'Adding a package description to a file:' \
    "sudo dnf info \$1 | grep 'Имя Репозиторий Из репо Краткое URL Лицензия Описание'"

  echo -n 'Run first preparation system (N/y)'
  read temp_one
  if [[ "${temp_one}" == 'y' ]]; then
    . "${main_project_path}/system/preparation/RUN"
  fi

  echo -n 'Sort ${main_txt_file} (N/y)'
  read temp_one
  if [[ "${temp_one}" == 'y' ]]; then
    # cat ${main_txt_file} | xargs | sort -uid -o "${main_txt_file}"
    cat ${main_txt_file} | sed '/^$/d' | sort -uid -o "${main_txt_file}"
  fi

  . "${main_project_path}/repository/adobe" -a
  # . "${main_project_path}/repository/arangodb" -a
  . "${main_project_path}/repository/rpmfusion" -a
  # . "${main_project_path}/repository/rpmsphere" -a
  # . "${main_project_path}/repository/unitedrpms" -a
  . "${main_project_path}/repository/vscode" -a

  . "${main_project_path}/application/installation/rpm/kernel-pack" -a
  . "${main_project_path}/application/installation/rpm/core-pack" -a

  . "${main_project_path}/application/installation/rpm/library/additionally-graphical-system-pack" -a
  . "${main_project_path}/application/installation/rpm/library/alsa" -a
  . "${main_project_path}/application/installation/rpm/library/codek-pack" -a
  . "${main_project_path}/application/installation/rpm/library/GLC" -a
  . "${main_project_path}/application/installation/rpm/library/GLee" -a
  . "${main_project_path}/application/installation/rpm/library/graphical-pack" -a
  . "${main_project_path}/application/installation/rpm/library/gstreamer1" -a
  . "${main_project_path}/application/installation/rpm/library/gstreamermm" -a
  . "${main_project_path}/application/installation/rpm/library/libQGLViewer" -a
  . "${main_project_path}/application/installation/rpm/library/mesa" -a
  . "${main_project_path}/application/installation/rpm/library/openal-soft" -a
  . "${main_project_path}/application/installation/rpm/library/SDL" -a
  . "${main_project_path}/application/installation/rpm/library/wxGTK" -a

  . "${main_project_path}/application/installation/rpm/archive-pack" -a
  . "${main_project_path}/application/installation/rpm/certbot" -a
  . "${main_project_path}/application/installation/rpm/cups" -a
  . "${main_project_path}/application/installation/rpm/flash-player" -a
  . "${main_project_path}/application/installation/rpm/fuse-utilities" -a
  . "${main_project_path}/application/installation/rpm/gdb" -a
  . "${main_project_path}/application/installation/rpm/geoip" -a
  . "${main_project_path}/application/installation/rpm/git" -a
  . "${main_project_path}/application/installation/rpm/gnome-shell" -a
  . "${main_project_path}/application/installation/rpm/graphical-pack" -a
  . "${main_project_path}/application/installation/rpm/gvfs" -a
  . "${main_project_path}/application/installation/rpm/hard-drive" -a
  . "${main_project_path}/application/installation/rpm/hashes-pack" -a
  . "${main_project_path}/application/installation/rpm/kompare-merge-pack" -a
  . "${main_project_path}/application/installation/rpm/media-pack" -a
  . "${main_project_path}/application/installation/rpm/nginx" -a
  . "${main_project_path}/application/installation/rpm/office-text-editors-and-more" -a
  . "${main_project_path}/application/installation/rpm/openssh" -a
  . "${main_project_path}/application/installation/rpm/PackageKit" -a
  . "${main_project_path}/application/installation/rpm/pulseaudio" -a
  . "${main_project_path}/application/installation/rpm/system-and-programming-tools" -a
  . "${main_project_path}/application/installation/rpm/terminal-pack" -a
  . "${main_project_path}/application/installation/rpm/universally-unique-identifier" -a
  . "${main_project_path}/application/installation/rpm/VirtualGL" -a

  . "${main_project_path}/application/programming-languages/rpm/additionally" -a
  . "${main_project_path}/application/programming-languages/rpm/c" -a
  . "${main_project_path}/application/programming-languages/rpm/clang" -a
  . "${main_project_path}/application/programming-languages/rpm/ghc" -a
  . "${main_project_path}/application/programming-languages/rpm/gmp" -a
  . "${main_project_path}/application/programming-languages/rpm/GtkAda" -a
  . "${main_project_path}/application/programming-languages/rpm/lua" -a
  . "${main_project_path}/application/programming-languages/rpm/perl" -a
  . "${main_project_path}/application/programming-languages/rpm/php" -a
  . "${main_project_path}/application/programming-languages/rpm/python" -a
  . "${main_project_path}/application/programming-languages/rpm/TCL" -a

  . "${main_project_path}/application/installation/rpm/vscode" -a
  . "${main_project_path}/application/installation/rpm/krusader" -a
  . "${main_project_path}/application/installation/rpm/wallpaper" -a

  . "${main_project_path}/application/prepartion/monitoring-computer-parameter" -a
  . "${main_project_path}/application/prepartion/vscode" -a

  pm -a "$@" -- "$(cat ${main_txt_file})"

}

main_main_script_source "$@"
